

#### tensorflow数据加载

1. keras.datasets

   一些常用的数据集

   - boston housing
     - Boston housing price regression dataset
   - mnist/fashion mnist
     - MNIST/Fashion-MNIST dataset
   - cifar10/100
     - small images classification dataset
   - imdb
     - sentiment classification dataset

   例如加载mnist数据集

   ```python
   (x, y), (x_test, y_test) = keras.datasets.mnist.load_data()
   # 得到的是一个numpy的数据
   ```

   

2. tf.data.Dataset

   - from_tensor_slices()

     将numpy数据转换为tensor

     ```python
    (x, y), (x_test, y_test) = keras.datasets.mnist.load_data()  # 得到的是numpy的数据类型
     db = tf.data.Dataset.from_tensor_slices(x_test)
    next(iter(db)).shape
     # TensorShape([32, 32, 3])
    
     db = tf.data.Dataset.from_tensor_slices((x_test, y_test))
    next(iter(db))[0].shape
     # TensorShape([32, 32, 3])
     ```
     
     这里可以同时传入两个，分别是image和label     

   - shuffle(n)
   
     将样本进行打散，顺序打乱。n为打撒的范围，一般调大点就可以了
   
   - map
   
     在对数据进行初始化的时候可以使用，与python自带的map类似，不过自带的map是**map(function, iterable,...)**
   
     **function**:是一个数名
   
     **iterable**是一个可迭代的对象，例如列表、元祖、字符串
   
     ```python
     a=(1,2,3,4,5)
     b=[1,2,3,4,5]
     c="zhangkang"
     
     la=map(str,a)
     lb=map(str,b)
     lc=map(str,c)
     
     print(la)
     print(lb)
     print(lc)
     
     输出：
     ['1', '2', '3', '4', '5']
     ['1', '2', '3', '4', '5']
     ['z', 'h', 'a', 'n', 'g', 'k', 'a', 'n', 'g']
     
     def add(x,y,z):
         return x+y+z
     
     list1=[1,2,3]
     list2=[1,2,3]
     list3=[1,2,3]
     res=map(add,list1,list2,list3)
     print(res)
     
     输出：[3, 6, 9]
     ```
   
     在TensorFlow中使用
   
     ```python
     def fun(x, y):
       return x + y
     
     db = tf.data.Dataset.range(5)
     db = db.map(fun)
     # 就这样就在db上使用了map，等同于db = map(fun, db)
     
     
     def preprocess(x, y):
       x = tf.cast(x, dtype=tf.float32) / 255.
       y = tf.cast(y, dtype=tf.int32)
       y = tf.one_hot(y, depth=10)
       
     db2 = db.map(preprocess)
     res = next(iter(db2))
     res[0].shape, res[1].shape
     # (TensorShape([32, 32, 3]), TensorShape([1, 10]))
     ```
   
   - batch
   
     对加载的数据进行分组
   
     ```python
     db3 = db2.batch(32)  # 每32分为一组
     res = next(iter(db3))
     res[0].shape, res[1].shape
     (TensorShape([32, 32, 32,3]), TensorShape([32, 1, 10]))
     ```
   
     
   
   - repeat
   
     可以重复在for循环中迭代，正常情况下一个可迭代的数据在for循环中迭代一次就自动退出了。如果想对一个可迭代数据进行多次迭代可以用`repeat`
   
     ```python
     db2 = db.repeat()  # 可迭代无穷次
     db2 = db.repeat(2)  # 可迭代2次
     ```
   
     