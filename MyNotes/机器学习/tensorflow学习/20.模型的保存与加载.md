### 模型的保存与加载

#### Outline

- save/load weights

  只保留网络参数

- save/load entire model

  将所有状态都保存起来

- saved_model

  模型保存格式

#### Content

1. Save the weights

   ```python
   # save the weights
   model.save_weights('./checkpoints/my_checkpoint')
   
   # Restore the weight
   # 在这之前应该先要重新创建网络，Sequential和compile
   # model = create_model()
   model.load_weights('./checkpoints/my_checkpoint')
   
   # loss, acc = model.evaluate(test_images, test_labels)
   # print("Restored model, accuracy:{:5.2f}%".format(100*acc))
   network.evaluate(ds_val)  # da_val是测试集
   ```

2. Save entire model

   ```python
   # save entire model
   network.save('model.h5')
   
   # restore model,不需要重新创建网络
   network = tf.keras.models.load_model('model.h5')
   
   # test
   network.evaluate(ds_val)
   ```

3. saved_model

   这种方式主要用于工业环境的部署，saved_model是一种协议，可以导入其他语言使用

   ```python
   # save
   tf.saved_model.save(m, '/tmp/saved_model/')
   
   # restore
   imported = tf.saved_model.load(path)
   f = imported.signatures["serving_default"]  # 通过这种方法，将网络结构导引出来
   print(f(x=tf.ones([1, 28, 28, 3])))  # 测试
   ```

   