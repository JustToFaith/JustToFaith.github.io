# 防作弊系统部署文档

[TOC]

## Java 后端部署

### 部署环境

> 注：如果是部署在外部服务器，需要有 ssl 证书的，否则如果使用谷歌浏览器访问，可能无法调用摄像头。

- JDK1.8
- Mysql 5.x
- Redis 5.x

### 部署配置修改

#### 1. 加载项目相关依赖

在项目根目录下，将`pom.xml`中的依赖加载。

#### 2. 数据库连接修改

> 在本次提交的代码中，默认连接的是阿里云的 Mysql 和 Redis，理论上是可以直接使用，如有特殊需求请自行更改。数据库的脚本文件放置本文档的同级目录下。

##### Mysql 配置修改

将`java`文件中，在`resources`目录下的``applicationContext.xml`中修改如下配置。

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9i1jtc4bj31ce08stb2.jpg" alt="image-20200529183156981" style="zoom:50%;" />

如图将自己服务器的地址，端口号和数据库名称写到`jdbcUrl`中的画线部分；

数据库的用户名写到`user`中，第二条画线部分；

数据库的密码写到`password`中，第三条画线部分。

##### Redis 配置修改

将`java`文件中，在`resources`目录下的`jedis.properties`中修改，如下图所示。

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9ihs1klbj30y005u750.jpg" alt="image-20200529184733207" style="zoom:50%;" />

`host`中填写`redis`的地址

`post`填写端口

`password`填写密码



#### 3. 修改访问外部资源路径

```
├── java
├── resources
└── webapp     
    └── jsp
        ├── answer_page.jsp
        └── take_photo.jsp
```

- `take_photo.jsp`文件中，将如下IP地址和端口号改为`python flask`服务端的地址

  <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfbjc7g5g0j30w80a675o.jpg" alt="image-20200531124752587" style="zoom:33%;" />

- `nswer_page.jsp`文件目录中，将如下IP地址和端口号改为`python flask`服务端的地址

  <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfbjeocgzyj311s070jt3.jpg" alt="image-20200531125017719" style="zoom:33%;" />

- `nswer_page.jsp`文件目录中，将如下IP地址和端口号改为`java web`服务端的地址和项目路径

  ![image-20200531125257064](https://tva1.sinaimg.cn/large/007S8ZIlly1gfbjhfy85kj319g02smxo.jpg)

  

## Python 后端部署

### 1. 部署环境

- python3
- Mysql 5.x
- Redis 5.x
- flask
- dlib
- TensorFlow2.1
- opencv-python
- face_recognition

### 2. 数据库连接修改

#### MySql

在`config.pyt`文件中修改连接数据库的用户名、密码、地址、端口号和数据库名。

![image-20200529221848712](https://tva1.sinaimg.cn/large/007S8ZIlly1gf9ollbnonj31da04ogme.jpg)

#### Redis

在`extend.pyt`中修改地址、端口和密码

![image-20200529222019076](https://tva1.sinaimg.cn/large/007S8ZIlly1gf9on5hgl9j31jk01q3z0.jpg)



### 3. 深度学习作弊检测部分

#### 安装相关依赖

- 手动安装`dlib`，进入此[链接](https://gist.github.com/ageitgey/629d75c1baac34dfa5ca2a1928a7aeaf)，根据步骤安装。
- 自动安装 `python`相关依赖，使用终端进入项目目录，使用`pip3 install -r requirements.txt`安装相关依赖



## 安卓部署

### 安卓访问接口地址修改

> 安卓中需要修改访问服务器的地址，在提交的`apk`中使用的是我们自己服务器的地址，在使用前需要将地址改为部署 java 服务器的地址（最好有 ssl 证书的）。

```
.
└── com
    └── example
        └── app1
            ├── biz
            │   └── UserBiz.java
```

进入安卓项目工程，找到 `java`文件夹。进入此目录之后，通过上述目录结构进入`UserBiz.java`文件。

将文件中的如下图中两画线部分改为自己服务的域名或者`ip`地址，其中`anti-cheating`为`tomcat`的项目路径，若`tomcat`中没有设置项目路径，则可以去掉。

<img src="/Users/liz/Library/Application Support/typora-user-images/image-20200529224946227.png" alt="image-20200529224946227" style="zoom:50%;" />

