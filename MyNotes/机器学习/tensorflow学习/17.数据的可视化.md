## 数据的可视化

#### TensorBoard

1. 写入标量数据

   ```python
   with summary_writer.as_default():
     tf.summary.scalar('loss', float(loss), step=epoch)
     tf.summary.scalar('accuracy', float(train_accuracy), step=epoch)
     
   # loss为图表的名字，float(loss)把loss转换为数值然后作为y，step为x
   ```

2. 写入图片数据

   - 单张图片

     ```python 
     # get x from (x, y)
     sample_img = next(iter(db))[0]
     # get first image instance
     sample_img = sample_img[0]
     sample_img = tf.reshape(sample_img [1, 28, 28, 1])
     with summary_writer.as_default():
       tf.summary.image("Training sample:", sample_img, step=0)
       
     ```

   - 多张图片

     ```python
     val_images = x[:25]
     val_images = tf.reshape(val_images, [-1, 28, 28, 1])
     with summary_writer.as_default():
       tf.summary.scalar('test-acc', float(loss), step=step)
       tf.summary.image("val-onebyone-images:", val_images, max_outputs=25, step=step)
     ```

     上述方法可以显示多张图片，但是每张图片也是占用一个单元。这就导致了多张图片占用了大量页面布局，看着很繁琐。

     使用如下方法，自己建立一个函数，使得多张图片组合成一张图片。

     ```python
     import datetime
     from matplotlib import pyplot as plt
     import io
     
     
     def plot_to_image(figure):
       """Converts the matplotlib plot specified by 'figure' to a PNG image and
       returns it. The supplied figure is closed and inaccessible after this call."""
       # Save the plot to a PNG in memory.
       buf = io.BytesIO()
       plt.savefig(buf, format='png')
       # Closing the figure prevents it from being displayed directly inside
       # the notebook.
       plt.close(figure)
       buf.seek(0)
       # Convert PNG buffer to TF image
       image = tf.image.decode_png(buf.getvalue(), channels=4)
       # Add the batch dimension
       image = tf.expand_dims(image, 0)
       return image
     
     def image_grid(images):
       """Return a 5x5 grid of the MNIST images as a matplotlib figure."""
       # Create a figure to contain the plot.
       figure = plt.figure(figsize=(10,10))
       for i in range(25):
         # Start next subplot.
         plt.subplot(5, 5, i + 1, title='name')
         plt.xticks([])
         plt.yticks([])
         plt.grid(False)
         plt.imshow(images[i], cmap=plt.cm.binary)
       
       return figur
     
     
     current_time = datetime.datetime.now().strftime("%Y%m%d-%H%M%S")
     log_dir = 'logs/' + current_time
     summary_writer = tf.summary.create_file_writer(log_dir) 
     
     val_images = x[:25]
     with summary_writer.as_default():
       val_images = tf.reshape(val_images, [-1, 28, 28])
       figure  = image_grid(val_images)
       tf.summary.image('val-images:', plot_to_image(figure), step=step)
     ```

     

   